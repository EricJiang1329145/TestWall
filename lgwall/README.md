# 校园墙Vue应用

这是一个用于获取并显示校园墙帖子数据的Vue应用。

## 功能

- 通过访问 `https://www.rz101.com/api/get_messages` 获取帖子数据
- 直接显示返回的JSON内容
- 提供刷新数据功能
- 显示加载状态和错误处理

## 技术栈

- Vue 3 (TypeScript)
- Vite
- Tauri

## 开发

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

## 构建

```bash
# 构建应用
npm run build
```

## 修改记录

### 2025-04-05
- 修改App.vue，实现从服务器获取帖子数据并显示JSON内容
- 添加了加载状态和错误处理
- 添加了刷新数据功能

### 2025-04-06
- 修改App.vue，实现评论功能，用户可以对帖子发表评论
- 添加了评论提交的API调用逻辑
- 修复评论提交后UI不更新的问题，确保评论能立即显示

### 2025-04-07
- 恢复帖子内容的完整显示，修复分页功能，添加关于帖子显示数量决定因素的文档说明
- 删除使用模拟数据按钮
- 添加深色模式功能以及深浅模式切换按钮

### 2025-09-13
- 将原有的emoji图标替换为Material Design Icons图标库

### 2025-01-15
- **代码结构优化**: 将App.vue拆分为多个组件和组合式函数
  - 创建 `src/components/Header.vue` - 头部导航组件
  - 创建 `src/components/PostCard.vue` - 帖子卡片组件
  - 创建 `src/components/Pagination.vue` - 分页组件
  - 创建 `src/composables/useMessages.ts` - 帖子数据管理组合式函数
  - 创建 `src/composables/useDarkMode.ts` - 深色模式管理组合式函数
  - 创建 `src/composables/useComments.ts` - 评论管理组合式函数
  - 创建 `src/types/index.ts` - TypeScript类型定义文件
- **TypeScript类型安全**: 添加完整的类型定义，包括Message、Comment等接口
- **组件化架构**: 重构App.vue使用组件化架构，提高代码可维护性和复用性
- **逻辑复用**: 使用Vue 3组合式API实现逻辑复用，分离关注点
- **修复分页问题**: 修复分页计算逻辑，解决只显示9月6日18:25前帖子的问题
- **评论分页功能**: 实现评论数量超过5条时自动启用分页显示，支持上一页/下一页导航和页码选择
- **响应式多列布局**: 实现屏幕宽度检测，自动切换布局模式：
  - 单列: < 700px
  - 两列: 700px ~ 1080px  
  - 三列: >= 1080px
    提高不同屏幕尺寸的设备利用率
- **小红书式帖子排列**: 实现类似小红书的展示效果，同一行或相邻行内的帖子时间尽可能接近，整体实现从左到右、从上到下的时间顺序排列
- **完善的媒体文件展示功能**: 实现图片点击查看原图、视频点击播放、附件下载功能，支持缩略图优化加载
  - 图片文件: 支持点击查看原图，使用缩略图优化加载
  - 视频文件: 支持点击播放，MP4和PNG格式支持缩略图
  - 其他文件: 支持点击下载，使用Material Design图标
  - 域名支持: 使用 `www.rz101.com/static/uploads/` 访问原文件，`www.rz101.com/static/tiny_files/` 访问缩略图
- **智能高度平衡布局**: 实现多列布局下的智能高度平衡算法，解决各列高度不均匀问题
  - 基于内容长度、图片数量、视频数量、评论数量等因素估算帖子虚拟高度
  - 采用最小高度优先分配策略，确保各列高度均匀分布
  - 支持两列和三列布局模式，实现页面底部完美对齐

### 2025-04-07
- **TypeScript错误修复**: 修复PostCard.vue组件中的TypeScript类型错误
  - 修复 `e.target` 可能为 `null` 的类型检查问题
  - 修复 `EventTarget` 类型上不存在 `src` 和 `value` 属性的错误
  - 删除未使用的 `Comment` 类型导入和 `getFileIcon` 函数
  - 增强 `querySelector` 的类型安全性

### 2025-04-08
- **评论区显示优化**: 将评论区翻页功能改为滚动显示
  - 移除评论分页相关逻辑，包括分页状态、计算属性和控制方法
  - 修改评论列表渲染方式，直接显示所有评论并支持滚动浏览
  - 添加滚动条样式，优化用户体验

### 2025-04-09
- **TypeScript错误修复**: 修复App.vue组件中的TypeScript类型错误
  - 修复 `messages.value.findIndex` 中的参数类型问题
  - 修复分页组件事件名称不匹配的问题
  - 修复评论数组可能为undefined的类型检查问题

### 2025-04-10
- **TypeScript警告修复**: 修复Header.vue组件中的TypeScript警告
  - 移除不必要的vue导入语句
  - 优化props的使用方式，明确使用props.isDarkMode而不是直接使用isDarkMode

### 2025-04-11
- **TypeScript警告修复**: 修复PostCard.vue组件中的TypeScript警告
  - 移除未使用的computed导入
  - 移除未使用的ChevronLeftIcon和ChevronRightIcon导入

### 2025-04-12
- **无限滚动加载**: 将分页浏览改为无限滚动加载模式
  - 移除分页组件和相关逻辑
  - 实现滚动到底部自动加载下一页功能
  - 添加加载更多提示和已加载全部提示
  - 优化数据加载体验，支持追加式数据加载
  - 保持原有响应式布局和多列显示功能
  - 详细文档见 `docs/infinite-scroll-guide.md`

### 2025-04-13
- **加载按钮状态优化**: 优化加载更多按钮的交互体验
  - 添加点击时的加载状态显示
  - 实现按钮文字从"加载更多"变为"加载中..."的切换
  - 添加转圈动画效果，提升用户体验
  - 防止重复点击，加载过程中禁用按钮

### 2025-04-14
- **紫色主题统一优化**
  - 主题色系统：建立完整的紫色CSS变量系统
  - 深色模式：使用深紫色调（#8b5cf6等）
  - 浅色模式：使用浅紫色调（#7c3aed等）
  - 渐变效果：添加紫色渐变背景和按钮样式
  - 组件适配：所有组件统一使用紫色主题变量
- **评论区域布局优化**：将评论者名称和日期移动到头像右侧
