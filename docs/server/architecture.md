# 服务器端程序架构

## 目录结构

```
campusWall/
├── app.py                 # 主应用文件，包含所有路由定义
├── message.py             # 消息管理模块
├── managers.json          # 管理员账户信息
├── requirements.txt       # Python依赖包
├── static/                # 静态文件目录
│   ├── css/               # CSS样式文件
│   ├── js/                # JavaScript文件
│   └── tiny_files/        # 缩略图文件
├── templates/             # HTML模板文件
│   ├── wall.html          # 主页面模板
│   ├── message_detail.html # 消息详情页面模板
│   └── ...                # 其他页面模板
├── messages/              # 消息数据存储目录
│   ├── 1000001/           # 单条消息目录（以ID命名）
│   │   └── message.json   # 消息数据文件
│   └── ...                # 其他消息目录
├── deleted_messages/      # 已删除消息存储目录
├── logs/                  # 日志文件目录
└── help/                  # 帮助和举报相关文件
    ├── help.json          # 用户帮助请求
    └── report.json        # 用户举报信息
```

## 核心组件

### 1. 主应用 (app.py)

主应用文件基于Flask框架，负责处理所有HTTP请求，包括：

- API接口路由
- 页面渲染路由
- 文件上传处理
- 会话管理
- 错误处理

### 2. 消息管理 (message.py)

消息管理模块负责处理所有与消息相关的操作：

- 消息的创建、读取、更新、删除 (CRUD)
- 评论管理
- 点赞/点踩功能
- 消息搜索和过滤
- 热门消息计算

### 3. 数据存储

采用文件系统存储，每条消息以独立目录形式存储，目录名为消息ID，目录内包含`message.json`文件存储消息的所有信息。

## 运行逻辑

1. **应用启动**：
   - Flask应用初始化
   - 配置静态文件目录和上传目录
   - 设置中间件和会话管理
   - 初始化消息管理器

2. **请求处理流程**：
   - 用户发起请求到指定路由
   - Flask路由装饰器捕获请求
   - 调用对应处理函数
   - 处理函数调用消息管理器进行数据操作
   - 返回JSON响应或渲染HTML页面

3. **数据管理**：
   - 消息管理器在初始化时加载所有消息数据
   - 使用多线程自动刷新消息列表
   - 所有数据操作实时保存到文件系统